#! /usr/bin/env bash
# -*-mode:sh-*- vim:ft=shell-script
# shellcheck shell=bash

# fzf-preview
# =============================================================================
# Previews different types of items for FZF.

input="$1"
command_history=$(echo -ne "${input}" | tr -s ' ' | cut -d ' ' -f 2-)

if [[ -e ${input} && $(file --mime "${input}") =~ /directory ]]; then
  # directory
  tree -C --dirsfirst -L 2 "${input}" || head -200

elif [[ -e ${input} && $(file --mime "${input}") =~ binary ]]; then
  # binary file
  echo -ne "$(basename "$input")\n\nThis is a binary file"

elif [[ -e $(echo -ne "${input}" | cut -d " " -f 2 2> /dev/null) ]]; then
  # readable file
  f=$(echo -ne "${input}" | cut -d " " -f 2)
  (bat --color=always --wrap never --style=plain --line-range :200 "$f") 2> /dev/null

elif builtin command -v "$(echo -ne "${command_history}" | cut -d ' ' -f 1)" > /dev/null 2>&1; then
  # history
  (echo -ne "${command_history}" | bat --color=always --wrap character --terminal-width 80 -l sh --style=plain --line-range :200 || echo -ne "${command_history}") 2> /dev/null

else
  # other
  (echo -ne "${input}" | bat --color=always --wrap never --style=plain --line-range :200 || echo -ne "${input}") 2> /dev/null
fi
